<!DOCTYPE html>
<html>
    <head>
        <title>Home</title>
        <meta charset="utf-8">
        <link href="../css/stile-homepage.css" rel="stylesheet">
        <script src="https://kit.fontawesome.com/ec08f2a466.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
        <input type="checkbox" id="check">  
        <label for="check">
            <i class="fas fa-bars" id="btn"></i>
            <i class="fas fa-times" id="cancel"></i>
        </label>

        <div class="sidebar">
            <header>
                <br>
                <img class="user-logo" src="../images/userlogo.png" alt="userlogo">
                <p class="user-name-surname">Nome Cognome</p>
                <p class="user-email">user@domain.com</p>
            </header>
            <ul>
                <li><a href="#"><i class="fas fa-list-ul"></i>Ordini</a></li>
                <li><a href="#"><i class="fas fa-shopping-bag"></i>Prodotti</a></li>
                <li><a href="#"><i class="fas fa-chart-bar"></i>Statistiche</a></li>
                <li><a href="#"><i class="fas fa-qrcode"></i>Scansione QR</a></li>
            </ul>
        </div>

        <div class="top">
            <br>
            <input type="text" placeholder="Ricerca Prodotti">
            <br><br>
        </div>
        <br><br>

        <div class="container">
            <a class="button" href="#" id="ricarica">
                <i class="fas fa-redo"></i> Reload
            </a>
        </div>
        <div class="container" id = "listaprodotti"></div>
        <script>
            //Ajax con jQuery, $ significa jQuery

            //Qui dichiaro una funzione che prende tutti i prodotti, verrà usata
            //quando carico la pagina per la prima volta e ogni volta che premo 
            //il bottone
            function prendiTuttiProdotti(data, status) {
                var listaProdotti = document.getElementById("listaprodotti");

                var divCategoria = document.createElement('div');
                divCategoria.className = "category";

                var titolo = document.createElement('h1');
                titolo.className = "category-name";

                titolo.appendChild(document.createTextNode("Prodotti"));
                divCategoria.appendChild(titolo);

                listaProdotti.appendChild(divCategoria);

                for (var i = 0; i < data.length; i++) {

                    var divMain = document.createElement('div');
                    divMain.className = "main";

                    var divProduct = document.createElement('div');
                    divProduct.className = "product";

                    var img = document.createElement('img');
                    img.className = "image-product";
                    img.setAttribute("alt", "product image");
                    img.setAttribute("src", "../images/shrekkino.jpg")

                    var nomeProdotto = document.createElement('h1');
                    nomeProdotto.className = "product-name";
                    nomeProdotto.appendChild(document.createTextNode((data[i].nome)));

                    var indirizzo = document.createElement('p');
                    indirizzo.className = "address";
                    //indirizzo.appendChild(document.createTextNode((data[i].indirizzo)));

                    var prezzo = document.createElement('p');
                    prezzo.className = "price";
                    prezzo.appendChild(document.createTextNode((data[i].prezzo) + "€"));

                    divProduct.appendChild(document.createElement('br'));
                    divProduct.appendChild(img);
                    divProduct.appendChild(nomeProdotto);
                    for (var j = 0; j < 5; j++) {
                        var tagI = document.createElement('i');
                        tagI.className = "fas fa-star";
                        divProduct.appendChild(tagI);
                    }
                    divProduct.appendChild(indirizzo);
                    divProduct.appendChild(prezzo);
                    divProduct.appendChild(document.createElement('br'));

                    divMain.appendChild(divProduct);
                    listaProdotti.appendChild(divMain);
                }
            }
            ;

            // N.B. la dicitura function dopo l'URL non è omissibile poiché
            //jQuery la converte nel suo codice. Per ovviare al problema di sdoppiare
            //il codice ho definito una funzione e la chiamo dentro function
            $(document).ready(function () {
                $.get("https://happyfarmer.herokuapp.com/prodotti", function (data, status) {
                    prendiTuttiProdotti(data, status);
                });
            });
            
            //Ricarica dinamica dei prodotti quando premo il pulsante.
            //Prima svuoto e poi richiamo la get.
            //Fare css.
            $(document).ready(function () {
                $("#ricarica").click(function () {
                    $.get("https://happyfarmer.herokuapp.com/prodotti", function (data, status) {
                        $("#listaprodotti").empty();
                        prendiTuttiProdotti(data, status);
                    });
                });
            });

        </script>
    </body>
</html>